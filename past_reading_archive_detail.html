<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <script src="js/api-base.js"></script>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/profile.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#cfa117",
                        "background-light": "#f8f7f6",
                        "background-dark": "#181611",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .parchment-texture {
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(207, 161, 23, 0.05) 1px, transparent 0),
                url("https://lh3.googleusercontent.com/aida-public/AB6AXuDoQZy9HVvAnjH7jiTRvGRM2iclMUDK29JStgLw4Pq-JCabmjlzNp2-mJFSYw6uvD3Ol-O4lCldbhZ2OCDCKo8UC-N5YHeTGZBWr1tKAr0fyayNLDcgy6xVCjoBmIxrtVXvjJ_csZTUQ5yyVv55STSo4gHu8XOs7t9C5fz5wcT-2EQVpp-irGbaDOb2wWjuCT3JB4mwiIhxl-cBpJs8oE_tyZA2UVgXKnbgYhYzPkOOd39cUdXJlPJ52pdZbx5OhPe7YtVGiqJcKZlG");
            background-size: 24px 24px, cover;
            background-position: center, center;
            background-blend-mode: overlay;
        }
        .scroll-mask {
            mask-image: linear-gradient(to bottom, transparent, black 5%, black 95%, transparent);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-white min-h-screen">
    <div class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md">
        <div class="flex items-center p-4 justify-between max-w-md mx-auto">
            <div onclick="window.location.href='name_numerology_breakdown_1.html'"
                class="flex size-12 items-center cursor-pointer">
                <span class="material-symbols-outlined text-gray-700 dark:text-white">arrow_back_ios</span>
            </div>
            <h2 class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-tight flex-1 text-center">
                Sacred Archive</h2>
            <div class="flex w-12 items-center justify-end">
                <button
                    class="flex cursor-pointer items-center justify-center rounded-xl h-12 bg-transparent text-gray-700 dark:text-white">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>
        </div>
    </div>
    <main class="max-w-md mx-auto relative">
        <div class="px-4 pt-6">
            <div class="bg-cover bg-center flex flex-col justify-end overflow-hidden bg-background-dark rounded-t-3xl min-h-[200px] border-x border-t border-primary/20 relative"
                style='background-image: linear-gradient(0deg, rgba(24, 22, 17, 1) 0%, rgba(24, 22, 17, 0.4) 100%), url("https://lh3.googleusercontent.com/aida-public/AB6AXuDoQZy9HVvAnjH7jiTRvGRM2iclMUDK29JStgLw4Pq-JCabmjlzNp2-mJFSYw6uvD3Ol-O4lCldbhZ2OCDCKo8UC-N5YHeTGZBWr1tKAr0fyayNLDcgy6xVCjoBmIxrtVXvjJ_csZTUQ5yyVv55STSo4gHu8XOs7t9C5fz5wcT-2EQVpp-irGbaDOb2wWjuCT3JB4mwiIhxl-cBpJs8oE_tyZA2UVgXKnbgYhYzPkOOd39cUdXJlPJ52pdZbx5OhPe7YtVGiqJcKZlG");'>
                <div class="flex p-6 flex-col gap-2">
                    <span class="text-primary text-xs font-bold uppercase tracking-[0.3em]">Eternal Archive
                        Record</span>
                    <h1 id="person-name-title" class="text-white tracking-tight text-3xl font-bold leading-tight">Full Destiny Analysis</h1>
                    <div class="flex items-center gap-6 mt-4 pt-4 border-t border-primary/20">
                        <div class="flex flex-col">
                            <span class="text-[10px] text-primary uppercase font-bold tracking-widest">Life Path</span>
                            <span id="life-path-value" class="text-2xl font-bold text-white">—</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[10px] text-primary uppercase font-bold tracking-widest">Soul Urge</span>
                            <span id="soul-urge-value" class="text-2xl font-bold text-white">—</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[10px] text-primary uppercase font-bold tracking-widest">Destiny</span>
                            <span id="destiny-value" class="text-2xl font-bold text-white">—</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-background-dark border-x border-primary/20">
            <p class="text-primary/60 text-[10px] font-medium uppercase tracking-[0.2em] py-2 text-center">
                Inscribed on October 14, 2023 • 11:11 PM
            </p>
        </div>
        <div
            class="mx-4 mb-12 rounded-b-3xl bg-white dark:bg-[#1e1b13] border-x border-b border-primary/20 shadow-2xl parchment-texture relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 opacity-10 pointer-events-none">
                <span class="material-symbols-outlined text-primary text-9xl leading-none"
                    style="font-variation-settings: 'FILL' 1">skillet</span>
            </div>
            <div class="absolute bottom-0 left-0 w-32 h-32 opacity-10 rotate-180 pointer-events-none">
                <span class="material-symbols-outlined text-primary text-9xl leading-none"
                    style="font-variation-settings: 'FILL' 1">skillet</span>
            </div>
            <div class="p-8 pt-4 space-y-8 text-gray-700 dark:text-[#d1cdbc] leading-relaxed text-lg relative z-10">
                <div class="flex justify-center py-4">
                    <span class="material-symbols-outlined text-primary opacity-40 text-4xl">auto_awesome</span>
                </div>
                <h3 id="archive-path-title"
                    class="text-gray-900 dark:text-white tracking-tight text-2xl font-bold leading-tight text-center italic border-b border-primary/10 pb-6">
                    The Path of the Seeker</h3>
                <p id="archive-para-1"
                    class="first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:mr-1 first-letter:float-left">
                    Your vibration as a <span class="text-primary font-bold">Number 7</span> indicates a profound
                    journey toward inner wisdom and spiritual truth. This reading, captured during the peak of your
                    solar cycle, suggests that your current path is one of introspection and analytical discovery.
                </p>
                <p id="archive-para-2">
                    With a <span class="text-primary font-bold">Soul Urge of 11</span>, you are a master intuitive. You
                    feel things before they happen, and your archive shows a consistent alignment with high-vibrational
                    energy shifts. The universe is calling you to trust the silence between your thoughts.
                </p>
                <div class="py-12 px-6 my-8 border-y border-primary/20 text-center relative">
                    <span
                        class="material-symbols-outlined absolute -top-4 left-1/2 -translate-x-1/2 bg-[#1e1b13] px-2 text-primary">format_quote</span>
                    <p id="archive-quote" class="italic text-xl text-primary/90 font-light leading-relaxed">
                        "The truth is not found in the noise of the world, but in the stillness of the archived soul."
                    </p>
                </div>
                <p id="archive-para-3">
                    Your <span class="text-primary font-bold">Destiny Number 5</span> provides the necessary friction to
                    prevent stagnation. While your Life Path seeks solitude, your Destiny demands movement and change.
                    This archived reading remains a testament to your ability to balance the static with the kinetic.
                </p>
                <p id="archive-para-4">
                    Looking back at this data, the alignment of the stars on October 14th provided a rare window for
                    manifesting career breakthroughs. Have you acted upon the whispers of your soul urge?
                </p>
                <div class="pt-12 pb-8 text-center">
                    <div class="h-px w-16 bg-primary/30 mx-auto mb-8"></div>
                    <p class="text-primary font-medium italic text-xl tracking-tight">
                        How has this wisdom shaped your journey since?
                    </p>
                    <div class="flex justify-center gap-4 mt-8 opacity-40">
                        <span class="material-symbols-outlined text-xs">circle</span>
                        <span class="material-symbols-outlined text-xs">circle</span>
                        <span class="material-symbols-outlined text-xs">circle</span>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div class="h-8"></div>


    <script>
    // ═══ PAST READING ARCHIVE - DYNAMIC PROFILE ═══
    window.addEventListener('load', async function() {
        // 1. URL parametresini kontrol et
        var params = new URLSearchParams(window.location.search);
        var kisiName = params.get('kisi');
        var personData = null;
        
        if (kisiName) {
            // Başkasının profili - connections'dan çek
            console.log('[Archive] URL kisi:', kisiName);
            if (window.profile && typeof window.profile.getConnectionDetail === 'function') {
                try {
                    personData = await window.profile.getConnectionDetail(kisiName);
                    console.log('[Archive] Connection bulundu:', personData);
                } catch(e) {
                    console.log('[Archive] Connection bulunamadı:', e);
                }
            }
        }
        
        // Ana kullanıcı veya veri bulunamadıysa
        if (!personData) {
            try {
                var ud = JSON.parse(localStorage.getItem('numerael_user_data') || '{}');
                personData = {
                    fullName: ud.name || 'User',
                    birthDate: ud.birthDate || null
                };
                console.log('[Archive] Ana kullanıcı:', personData);
            } catch(e) {}
        }
        
        if (!personData || !personData.fullName || !personData.birthDate) {
            console.log('[Archive] Veri yetersiz');
            return;
        }
        
        // 2. Numeroloji hesaplamaları
        var name = personData.fullName;
        var birthDate = personData.birthDate;
        
        // Life Path hesapla
        function calcLifePath(bd) {
            if (!bd) return null;
            var digits = bd.replace(/\D/g,'').split('').map(Number);
            var sum = digits.reduce(function(a,x){return a+x;},0);
            while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                sum = String(sum).split('').reduce(function(a,d){return a+parseInt(d);},0);
            }
            return sum;
        }
        
        // Soul Urge hesapla (sesli harfler)
        function calcSoulUrge(nm) {
            if (!nm) return null;
            var vowels = 'AEIOUaeiouÜüÖöİiAaEeIıOoUu';
            var sum = 0;
            for (var i = 0; i < nm.length; i++) {
                if (vowels.indexOf(nm[i]) !== -1) {
                    var val = NumerologyEngine.PYTHAGOREAN[nm[i].toUpperCase()];
                    if (val) sum += val;
                }
            }
            while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                sum = String(sum).split('').reduce(function(a,d){return a+parseInt(d);},0);
            }
            return sum || 1;
        }
        
        // Destiny hesapla (tüm harfler)
        function calcDestiny(nm) {
            if (!nm) return null;
            var letters = NumerologyEngine.getLetterValues(nm, NumerologyEngine.PYTHAGOREAN);
            var sum = letters.reduce(function(a,l){return a+(l.val||0);},0);
            while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                sum = String(sum).split('').reduce(function(a,d){return a+parseInt(d);},0);
            }
            return sum || 1;
        }
        
        var lifePath = calcLifePath(birthDate);
        var soulUrge = calcSoulUrge(name);
        var destiny = calcDestiny(name);
        
        console.log('[Archive] Hesaplamalar:', { lifePath, soulUrge, destiny });
        
        // 3. UI'ı güncelle
        var titleEl = document.getElementById('person-name-title');
        var lpEl = document.getElementById('life-path-value');
        var suEl = document.getElementById('soul-urge-value');
        var destEl = document.getElementById('destiny-value');
        
        if (titleEl) titleEl.textContent = name + "'s Destiny Analysis";
        if (lpEl) lpEl.textContent = lifePath || '?';
        if (suEl) suEl.textContent = soulUrge || '?';
        if (destEl) destEl.textContent = destiny || '?';
        
        // 4. AI ile dinamik içerik generate et — API key /api/openai proxy'si tarafından server-side ekleniyor
        if (lifePath && soulUrge && destiny) {
            var prompt = `Numeroloji okumasi: ${name} için Life Path ${lifePath}, Soul Urge ${soulUrge}, Destiny ${destiny}.\n\nİngilizce olarak 4 paragraf yaz (mistik ve derin bir üslupla):\n\n1. Life Path ${lifePath}'in anlamı ve ${name} için ne ifade ettiği\n2. Soul Urge ${soulUrge}'un kişilik ve iç dünyaya etkisi\n3. Destiny ${destiny}'nin Life Path ile dengesi\n4. Bu sayıların birleşiminin genel yorumu\n\nAyrıca bir alıntı cümlesi (quote) ekle.`;
            
            fetch((window.__NUMERAEL_API_BASE||'') + '/api/openai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: 'You are a mystical numerology reader. Write in an elegant, spiritual tone. Use HTML <span class="text-primary font-bold">tags for emphasis on numbers.' },
                        { role: 'user', content: prompt }
                    ],
                    temperature: 0.8,
                    max_tokens: 500
                })
            }).then(function(r){ return r.json(); }).then(function(d){
                if (d.choices && d.choices[0]) {
                    var text = d.choices[0].message.content.trim();
                    var paras = text.split('\n\n').filter(function(p){ return p.trim(); });
                    
                    // Paragrafları ata
                    var p1 = document.getElementById('archive-para-1');
                    var p2 = document.getElementById('archive-para-2');
                    var p3 = document.getElementById('archive-para-3');
                    var p4 = document.getElementById('archive-para-4');
                    var quote = document.getElementById('archive-quote');
                    
                    if (paras[0] && p1) p1.innerHTML = paras[0];
                    if (paras[1] && p2) p2.innerHTML = paras[1];
                    if (paras[2] && p3) p3.innerHTML = paras[2];
                    if (paras[3] && p4) p4.innerHTML = paras[3];
                    
                    // Quote için son cümleyi al
                    if (paras.length > 0 && quote) {
                        var lastPara = paras[paras.length - 1];
                        var sentences = lastPara.split('.');
                        if (sentences.length > 1) {
                            quote.textContent = '"' + sentences[sentences.length - 2].trim() + '."';
                        }
                    }
                    
                    // Başlığı güncelle
                    var titleEl = document.getElementById('archive-path-title');
                    var titleMap = {
                        1: 'The Path of the Pioneer',
                        2: 'The Path of the Diplomat',
                        3: 'The Path of the Creator',
                        4: 'The Path of the Builder',
                        5: 'The Path of Freedom',
                        6: 'The Path of the Nurturer',
                        7: 'The Path of the Seeker',
                        8: 'The Path of Power',
                        9: 'The Path of the Humanitarian',
                        11: 'The Path of the Visionary',
                        22: 'The Path of the Master',
                        33: 'The Path of the Teacher'
                    };
                    if (titleEl && titleMap[lifePath]) {
                        titleEl.textContent = titleMap[lifePath];
                    }
                }
            }).catch(function(e){ console.log('[Archive] AI error:', e); });
        }
        
    });
    </script>
    
    <script>
            // NUMERAEL APP - Navigation Helper
            (function () {
                // Auto navigation için
                var autoTarget = '';
                var autoDelay = 2500;

                if (autoTarget) {
                    setTimeout(function () {
                        window.location.href = autoTarget;
                    }, autoDelay);
                }

                // Bottom nav linkleri ekle
                setTimeout(function () {
                    // Home button
                    var allBtns = document.querySelectorAll('button, a');
                    allBtns.forEach(function (btn) {
                        var text = btn.textContent || '';
                        var html = btn.innerHTML || '';

                        // Home nav
                        if ((text.includes('Home') || html.includes('>home<')) && text.trim().length < 20) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'mystic_numerology_home_1.html';
                            });
                        }
                        // Crystal Store / Journal
                        if (text.includes('Crystal Store') || text.includes('Journal')) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'premium_crystal_store.html';
                            });
                        }
                        // Profile / Settings nav
                        if ((text.includes('Profile') || html.includes('>settings<')) && text.trim().length < 20) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'profile_soul_journey.html';
                            });
                        }
                    });
                }, 500);
            })();

        setTimeout(function () {

            // arrow_back → mystic_numerology_home_1.html
            document.querySelectorAll('button, a, [class*="cursor"]').forEach(function (el) {
                var txt = (el.textContent || '') + (el.innerHTML || '');
                if (txt.includes('arrow_back')) {
                    el.style.cursor = 'pointer';
                    el.addEventListener('click', function (e) {
                        e.stopPropagation();
                        window.location.href = 'mystic_numerology_home_1.html';
                    });
                }
            });

            // delete → mystic_numerology_home_1.html
            document.querySelectorAll('button, a, [class*="cursor"]').forEach(function (el) {
                var txt = (el.textContent || '') + (el.innerHTML || '');
                if (txt.includes('delete')) {
                    el.style.cursor = 'pointer';
                    el.addEventListener('click', function (e) {
                        e.stopPropagation();
                        window.location.href = 'mystic_numerology_home_1.html';
                    });
                }
            });

        }, 100);
    </script>


    <script src="js/numerology-engine.js"></script>
    <script src="js/numerology-context-engine.js"></script>
    <script src="js/decision-timing-engine.js"></script>
    <script src="js/numerology-ai.js"></script>
<script src="js/notification-engine.js"></script>
<script src="js/bottom-nav.js"></script>
</body>

</html>