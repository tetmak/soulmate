<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Premium Checkout</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/revenuecat.js"></script>
    <script src="js/premium.js"></script>
    <script>tailwind.config={darkMode:"class",theme:{extend:{colors:{primary:"#f2cc0d","background-dark":"#181711","surface-dark":"#221f10","card-dark":"#393628"},fontFamily:{display:["Space Grotesk","sans-serif"]},borderRadius:{DEFAULT:"1rem",lg:"2rem",xl:"3rem",full:"9999px"}}}}</script>
    <style>
        .material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24}
        body{min-height:max(884px,100dvh);font-family:'Space Grotesk',sans-serif}
        .pm-grad{background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 50%,#6366f1 100%)}
        .pm-text{background:linear-gradient(135deg,#c084fc,#f472b6,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .pm-glow{box-shadow:0 0 30px rgba(139,92,246,0.25)}
        .gp{background:rgba(139,92,246,0.06);backdrop-filter:blur(12px);border:1px solid rgba(139,92,246,0.12)}
        .glass{background:rgba(57,54,40,0.3);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.05)}
        @keyframes fade-up{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        @keyframes success-pop{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}100%{transform:scale(1);opacity:1}}
        .fade-up{animation:fade-up 0.5s ease forwards;opacity:0}
        .success-icon{animation:success-pop 0.6s cubic-bezier(0.34,1.56,0.64,1) forwards}
    </style>
</head>
<body class="bg-background-dark text-white min-h-screen">
<div class="relative flex h-auto min-h-screen w-full flex-col max-w-[480px] mx-auto overflow-x-hidden pb-10">

    <!-- Header -->
    <header class="flex items-center p-4 pb-2 justify-between sticky top-0 z-50 bg-background-dark/90 backdrop-blur-md border-b border-white/5">
        <div onclick="history.back()" class="flex size-12 shrink-0 items-center justify-start cursor-pointer text-white">
            <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-white text-lg font-bold flex-1 text-center">Ödeme</h2>
        <div class="w-12 flex items-center justify-end">
            <span class="material-symbols-outlined text-green-500/60 text-lg" style="font-variation-settings:'FILL' 1">lock</span>
        </div>
    </header>

    <!-- ═══ ÖDEME SAYFASI ═══ -->
    <div id="sec-checkout">

        <!-- Plan Özeti -->
        <div class="px-5 pt-6 pb-4 fade-up">
            <div class="gp rounded-2xl p-4 flex items-center gap-4">
                <div class="size-12 rounded-full pm-grad flex items-center justify-center shrink-0">
                    <span class="material-symbols-outlined text-white text-xl" style="font-variation-settings:'FILL' 1">workspace_premium</span>
                </div>
                <div class="flex-1">
                    <p class="text-white font-bold">Kader Premium</p>
                    <p id="plan-label" class="text-white/40 text-xs">—</p>
                </div>
                <div class="text-right">
                    <p id="plan-price" class="text-white text-lg font-black">—</p>
                    <p id="plan-period" class="text-white/25 text-xs">—</p>
                </div>
            </div>
            <p class="text-white/20 text-xs text-center mt-2">İlk 3 gün ücretsiz · İstediğin zaman iptal</p>
        </div>

        <!-- Bilgi Alanı -->
        <div class="px-5 pb-4 fade-up" style="animation-delay:0.06s">
            <div id="checkout-info" class="glass rounded-2xl p-6 text-center">
                <div class="size-14 rounded-full mx-auto mb-4 flex items-center justify-center" style="background:rgba(139,92,246,0.12)">
                    <span id="info-icon" class="material-symbols-outlined text-purple-400 text-2xl">shopping_cart</span>
                </div>
                <p id="info-title" class="text-white/60 text-sm font-bold mb-1">Güvenli Ödeme</p>
                <p id="info-desc" class="text-white/30 text-xs">Aşağıdaki butona basınca Paddle güvenli ödeme penceresi açılacak</p>
            </div>
        </div>

        <!-- Güvenlik Notu -->
        <div class="px-5 pb-4 fade-up" style="animation-delay:0.1s">
            <div class="flex items-center gap-3 px-4 py-3 glass rounded-xl">
                <span class="material-symbols-outlined text-green-400 text-base" style="font-variation-settings:'FILL' 1">verified_user</span>
                <p id="security-note" class="text-white/40 text-xs">Paddle güvenli ödeme · KDV otomatik dahil</p>
            </div>
        </div>

        <!-- Ödeme Butonu -->
        <div class="px-5 pb-4 fade-up" style="animation-delay:0.14s">
            <button id="btn-pay" class="w-full pm-grad text-white py-4 rounded-full font-bold text-base shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform pm-glow">
                <span class="material-symbols-outlined">credit_card</span>
                <span id="btn-pay-label">Ödemeyi Tamamla</span>
            </button>
        </div>

        <!-- Koşullar -->
        <div class="px-5 pb-4">
            <p class="text-white/15 text-[10px] text-center leading-relaxed">
                "Ödemeyi Tamamla"ya basarak Kader Kullanım Koşulları'nı kabul etmiş olursun.
                Abonelik seçilen dönem sonunda otomatik yenilenir. İstediğin zaman iptal edebilirsin.
            </p>
        </div>

        <!-- Ücretsiz devam et -->
        <div class="px-5 pb-8 text-center">
            <a id="btn-skip" href="mystic_numerology_home_1.html" class="text-white/25 text-xs font-bold hover:text-white/40 transition-colors">
                Şimdilik ücretsiz devam et →
            </a>
        </div>
    </div>

    <!-- ═══ BAŞARI EKRANI ═══ -->
    <div id="sec-success" style="display:none" class="flex-1 flex flex-col items-center justify-center px-6 text-center">
        <div class="size-28 rounded-full pm-grad flex items-center justify-center mb-8 pm-glow success-icon" style="opacity:0">
            <span class="material-symbols-outlined text-white text-6xl" style="font-variation-settings:'FILL' 1">check_circle</span>
        </div>
        <h2 class="text-white text-2xl font-black mb-3">Premium Aktif!</h2>
        <p class="text-white/40 text-sm leading-relaxed max-w-[300px] mb-2">Tebrikler! Artık Kader'in tüm özelliklerine sınırsız erişimin var.</p>
        <p id="trial-note" class="text-white/25 text-xs mb-8">3 günlük ücretsiz deneme başladı</p>
        <button id="btn-explore" class="w-full max-w-[300px] pm-grad text-white py-4 rounded-full font-bold text-base flex items-center justify-center gap-2 active:scale-95 transition-transform pm-glow">
            <span class="material-symbols-outlined">explore</span>
            Keşfe Başla
        </button>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var params = new URLSearchParams(window.location.search);
    var plan = params.get('plan') || 'yearly';
    var returnUrl = params.get('return') || 'mystic_numerology_home_1.html';

    // Skip butonu
    var skipBtn = document.getElementById('btn-skip');
    if (skipBtn) {
        try { skipBtn.href = decodeURIComponent(returnUrl); } catch(e) { skipBtn.href = 'mystic_numerology_home_1.html'; }
    }

    // Plan bilgisi göster
    if (plan === 'yearly') {
        document.getElementById('plan-label').textContent = 'Yıllık Plan';
        document.getElementById('plan-price').textContent = '₺599.99';
        document.getElementById('plan-period').textContent = '₺49.99/ay olarak';
    } else {
        document.getElementById('plan-label').textContent = 'Aylık Plan';
        document.getElementById('plan-price').textContent = '₺79.99';
        document.getElementById('plan-period').textContent = '/ ay';
    }

    // Zaten premium ise başarı ekranını göster
    if (window.premium && window.premium.isPremium()) {
        document.getElementById('sec-checkout').style.display = 'none';
        document.getElementById('sec-success').style.display = 'flex';
    }

    // Native platform: mağaza bilgilerini güncelle
    var isNative = window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();
    if (isNative) {
        var platform = window.Capacitor.getPlatform();
        var storeName = platform === 'ios' ? 'App Store' : 'Google Play';
        document.getElementById('info-icon').textContent = platform === 'ios' ? 'phone_iphone' : 'phone_android';
        document.getElementById('info-title').textContent = storeName + ' ile Ödeme';
        document.getElementById('info-desc').textContent = 'Aşağıdaki butona basınca ' + storeName + ' güvenli ödeme penceresi açılacak';
        document.getElementById('security-note').textContent = storeName + ' güvenli ödeme · ' + (platform === 'ios' ? 'Apple' : 'Google') + ' tarafından korunur';
        document.getElementById('btn-pay-label').textContent = storeName + ' ile Öde';

        // Native'de RevenueCat fiyatlarını göster (mağaza fiyatları)
        if (window.revenuecat && window.revenuecat.isReady()) {
            var pkgs = window.revenuecat.getPackages();
            for (var i = 0; i < pkgs.length; i++) {
                var pkg = pkgs[i];
                var pkgType = (pkg.packageType || '').toUpperCase();
                if (plan === 'yearly' && (pkgType === 'ANNUAL' || pkgType === 'YEARLY')) {
                    if (pkg.priceString) document.getElementById('plan-price').textContent = pkg.priceString;
                } else if (plan === 'monthly' && pkgType === 'MONTHLY') {
                    if (pkg.priceString) document.getElementById('plan-price').textContent = pkg.priceString;
                }
            }
        }
    }

    // ─── Ödeme butonu ──────────────────────────────────────
    document.getElementById('btn-pay').addEventListener('click', function() {
        if (window.premium && window.premium.startPurchase) {
            window.premium.startPurchase(plan);
        }
    });

    // ─── Keşfe başla ─────────────────────────────────────────
    document.getElementById('btn-explore').addEventListener('click', function() {
        try { window.location.href = decodeURIComponent(returnUrl); }
        catch(e) { window.location.href = 'mystic_numerology_home_1.html'; }
    });
});
</script>
</body>
</html>
