<!DOCTYPE html>

<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Mystic Sign Up</title>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script>console.log('[DEBUG] supabase:', typeof window.supabase, window.supabase ? 'OK' : 'MISSING');</script>
    <script src="js/supabase-config.js"></script>
    <script>console.log('[DEBUG] supabaseClient:', window.supabaseClient ? 'OK' : 'MISSING');</script>
    <script src="js/auth.js"></script>
    <script>console.log('[DEBUG] auth:', window.auth ? 'OK' : 'MISSING');</script>
    <script
        id="tailwind-config">tailwind.config = { darkMode: "class", theme: { extend: { colors: { primary: "#FAC638", "background-light": "#f8f8f5", "background-dark": "#231e0f" }, fontFamily: { display: "Plus Jakarta Sans" }, borderRadius: { DEFAULT: "1rem", lg: "2rem", xl: "3rem", full: "9999px" } } } };</script>
    <style>
        .nebula-bg {
            background: radial-gradient(circle at top right, rgba(244, 192, 37, 0.15), transparent),
                radial-gradient(circle at bottom left, rgba(120, 80, 220, 0.1), transparent),
                #181611;
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="font-display antialiased">
    <div
        class="relative flex min-h-screen w-full flex-col nebula-bg dark group/design-root overflow-x-hidden max-w-[430px] mx-auto shadow-2xl">
        <!-- TopAppBar -->
        <div class="flex items-center p-4 pb-2 justify-between">
            <div onclick="window.location.href='cosmic_onboarding_welcome.html'"
                class="text-white flex size-12 shrink-0 items-center cursor-pointer">
                <span class="material-symbols-outlined">arrow_back_ios</span>
            </div>
            <h2 id="page-title"
                class="text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Sign Up
            </h2>
        </div>
        <!-- Headline Section -->
        <div class="flex flex-col items-center px-6 pt-10 pb-6">
            <div
                class="w-20 h-20 mb-6 bg-primary/10 rounded-full flex items-center justify-center border border-primary/30">
                <span class="material-symbols-outlined text-primary text-4xl">auto_awesome</span>
            </div>
            <h1 class="text-white tracking-light text-[32px] font-bold leading-tight text-center">
                Begin your journey into the stars
            </h1>
            <p class="text-[#bab29c] text-center mt-3 text-sm px-4">
                Unlock your cosmic blueprint and discover the secrets hidden in your numbers.
            </p>
        </div>
        <!-- Form Section -->
        <div class="flex flex-col gap-1 px-4 mt-4">
            <!-- Full Name Field -->
            <div id="name-field" class="flex flex-wrap items-end gap-4 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-white text-base font-medium leading-normal pb-2 ml-1">Full Name</p>
                    <input id="input-name"
                        class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-1 focus:ring-primary border border-[#544e3b] bg-[#27241b]/60 backdrop-blur-sm focus:border-primary h-14 placeholder:text-[#bab29c]/50 p-[15px] text-base font-normal leading-normal"
                        placeholder="Enter your birth name" value="" />
                </label>
            </div>
            <!-- Email Field -->
            <div class="flex flex-wrap items-end gap-4 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-white text-base font-medium leading-normal pb-2 ml-1">Email</p>
                    <input id="input-email"
                        class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-1 focus:ring-primary border border-[#544e3b] bg-[#27241b]/60 backdrop-blur-sm focus:border-primary h-14 placeholder:text-[#bab29c]/50 p-[15px] text-base font-normal leading-normal"
                        placeholder="your.soul@cosmos.com" value="" />
                </label>
            </div>
            <!-- Password Field -->
            <div class="flex flex-wrap items-end gap-4 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                    <p id="password-label" class="text-white text-base font-medium leading-normal pb-2 ml-1">Create
                        Password</p>
                    <div class="flex w-full flex-1 items-stretch rounded-xl">
                        <input id="input-password"
                            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-1 focus:ring-primary border border-[#544e3b] bg-[#27241b]/60 backdrop-blur-sm focus:border-primary h-14 placeholder:text-[#bab29c]/50 p-[15px] rounded-r-none border-r-0 pr-2 text-base font-normal leading-normal"
                            placeholder="••••••••" type="password" value="" />
                        <div class="text-[#bab29c] flex border border-[#544e3b] bg-[#27241b]/60 backdrop-blur-sm items-center justify-center pr-[15px] rounded-r-xl border-l-0"
                            data-icon="Eye" data-size="24px" data-weight="regular">
                            <span class="material-symbols-outlined">visibility</span>
                        </div>
                    </div>
                </label>
            </div>
        </div>
        <!-- Footer Actions -->
        <div class="mt-auto px-4 pb-10 flex flex-col gap-4">
            <button id="btn-submit"
                class="w-full bg-primary hover:bg-primary/90 text-background-dark font-bold text-lg h-16 rounded-xl transition-all shadow-[0_0_25px_rgba(244,192,37,0.3)] flex items-center justify-center gap-2">
                <span id="btn-text">Create Soul Account</span>
                <span class="material-symbols-outlined">flare</span>
            </button>
            <p class="text-center text-[#bab29c] text-sm mt-4">
                <span id="toggle-msg">Already have an account?</span>
                <a id="btn-toggle"
                    class="text-primary font-semibold hover:underline decoration-primary/50 underline-offset-4 cursor-pointer">Login</a>
            </p>
        </div>
        <!-- Abstract Decoration -->
        <div class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-20 overflow-hidden -z-10">
            <div class="absolute top-1/4 -right-20 w-64 h-64 bg-primary blur-[120px] rounded-full"></div>
            <div class="absolute bottom-1/4 -left-20 w-64 h-64 bg-purple-600 blur-[120px] rounded-full"></div>
        </div>
    </div>

    <script>
        // NUMERAEL APP - Navigation Helper
        (function () {
            // Auto navigation için
            var autoTarget = '';
            var autoDelay = 2500;

            if (autoTarget) {
                setTimeout(function () {
                    window.location.href = autoTarget;
                }, autoDelay);
            }

            // Bottom nav linkleri ekle
            setTimeout(function () {
                // Home button
                var allBtns = document.querySelectorAll('button, a');
                allBtns.forEach(function (btn) {
                    var text = btn.textContent || '';
                    var html = btn.innerHTML || '';

                    // Home nav
                    if ((text.includes('Home') || html.includes('>home<')) && text.trim().length < 20) {
                        btn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.location.href = 'mystic_numerology_home_1.html';
                        });
                    }
                    // Crystal Store / Journal
                    if (text.includes('Crystal Store') || text.includes('Journal')) {
                        btn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.location.href = 'premium_crystal_store.html';
                        });
                    }
                    // Profile / Settings nav
                    if ((text.includes('Profile') || html.includes('>settings<')) && text.trim().length < 20) {
                        btn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.location.href = 'profile_soul_journey.html';
                        });
                    }
                });
            }, 500);
        })();

        // Auth State Management
        (function () {
            const params = new URLSearchParams(window.location.search);
            let isLoginMode = params.get('mode') === 'login';

            const btnToggle = document.getElementById('btn-toggle');
            const btnSubmit = document.getElementById('btn-submit');
            const pageTitle = document.getElementById('page-title');
            const btnText = document.getElementById('btn-text');
            const toggleMsg = document.getElementById('toggle-msg');
            const nameField = document.getElementById('name-field');
            const passwordLabel = document.getElementById('password-label');

            function updateUI() {
                if (isLoginMode) {
                    pageTitle.textContent = 'Login';
                    btnText.textContent = 'Login to Cosmic Soul';
                    toggleMsg.textContent = "Don't have an account?";
                    btnToggle.textContent = 'Sign Up';
                    nameField.style.display = 'none';
                    passwordLabel.textContent = 'Password';
                } else {
                    pageTitle.textContent = 'Sign Up';
                    btnText.textContent = 'Create Soul Account';
                    toggleMsg.textContent = 'Already have an account?';
                    btnToggle.textContent = 'Login';
                    nameField.style.display = 'flex';
                    passwordLabel.textContent = 'Create Password';
                }
            }

            updateUI();

            if (btnToggle) {
                btnToggle.addEventListener('click', function () {
                    isLoginMode = !isLoginMode;
                    updateUI();
                });
            }

            if (btnSubmit) {
                btnSubmit.addEventListener('click', async function () {
                    const email = document.getElementById('input-email').value;
                    const password = document.getElementById('input-password').value;
                    const fullName = document.getElementById('input-name').value;

                    if (!email || !password) {
                        alert('Lütfen e-posta ve şifrenizi giriniz.');
                        return;
                    }

                    try {
                        if (isLoginMode) {
                            await window.auth.signIn(email, password);
                            
                            // 1. Önce localStorage kontrol et
                            var hasProfile = false;
                            try {
                                var localData = JSON.parse(localStorage.getItem('numerael_user_data'));
                                if (localData && localData.name && localData.birthDate) {
                                    hasProfile = true;
                                    console.log('[Login] localStorage profil bulundu');
                                }
                            } catch(e) {}

                            // 2. localStorage'da yoksa Supabase'den çek
                            if (!hasProfile) {
                                try {
                                    var sess = await window.auth.getSession();
                                    if (sess && sess.user && window.supabaseClient) {
                                        var { data: prof, error: profError } = await window.supabaseClient
                                            .from('profiles')
                                            .select('*')
                                            .eq('id', sess.user.id)
                                            .single();
                                        if (!profError && prof && (prof.full_name || prof.name) && prof.birth_date) {
                                            localStorage.setItem('numerael_user_data', JSON.stringify({
                                                name: prof.full_name || prof.name,
                                                birthDate: prof.birth_date,
                                                birthTime: prof.birth_time || '',
                                                birthPlace: prof.birth_place || '',
                                                gender: prof.gender || 'male'
                                            }));
                                            hasProfile = true;
                                            console.log('[Login] Supabase profil bulundu, localStorage güncellendi');
                                        }
                                    }
                                } catch(profErr) { console.warn('[Login] Profil çekme hatası:', profErr); }
                            }

                            if (hasProfile) {
                                window.location.href = 'mystic_numerology_home_1.html';
                            } else {
                                window.location.href = 'data-ready_birth_form.html';
                            }
                        } else {
                            if (!fullName) {
                                alert('Lütfen adınızı giriniz.');
                                return;
                            }
                            await window.auth.signUp(email, password);
                            // Signup'ta adı hemen kaydet
                            localStorage.setItem('numerael_user_data', JSON.stringify({ name: fullName.trim() }));
                            window.location.href = 'data-ready_birth_form.html';
                        }
                    } catch (e) {
                        alert('Hata: ' + e.message);
                    }
                });
            }
        })();
    </script>


</body>

</html>
